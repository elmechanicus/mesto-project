(()=>{"use strict";var e={apiURL:"https://nomoreparties.co/v1/plus-cohort-5",headers:{authorization:"1a92109e-5904-468d-b1cc-bb517659891e","Content-Type":"application/json"}},t={formSelector:".popup__form",errorField:".popup__error",inputSelector:".popup__input",submitButtonSelector:".popup__save",inactiveButtonClass:"popup__save_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},n=document.querySelector(".profile__edit-button"),o=document.querySelector(".profile__add-button"),r=document.querySelector(".profile__new-avatar"),c=document.querySelector(".popup_type_edit-profile"),a=c.querySelector(".popup__form"),i=c.querySelector(".popup__input_type_name"),u=c.querySelector(".popup__input_type_occupation"),l=document.querySelector(".popup_type_add-card"),s=l.querySelector(".popup__form"),p=l.querySelector(".popup__input_type_name"),d=l.querySelector(".popup__input_type_url"),_=document.querySelector(".popup_type_view-image"),f=document.querySelector(".popup_type_new-avatar"),m=f.querySelector(".popup__form"),v=f.querySelector(".popup__input_type_url"),y=document.querySelector(".profile__avatar"),h=document.querySelector(".popup_type_delete-card"),S=h.querySelector(".popup__save"),q=document.querySelector(".profile__name"),L=document.querySelector(".profile__description"),b=document.querySelector(".elements");function C(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var E,k=document.querySelector("#card").content,g=_.querySelector(".popup__image"),x=_.querySelector(".popup__image-title");function A(t){var n=k.querySelector(".element").cloneNode(!0),o=n.querySelector(".element__photo"),r=n.querySelector(".element__text"),c=n.querySelector(".element__like-counter");r.textContent=t.name,o.alt=t.name,o.src=t.link,c.textContent=t.likes.length;for(var a=0;a<t.likes.length;a++)t.likes[a].name===t.owner.name&&n.querySelector(".element__like").classList.add("element__like_active");return o.addEventListener("click",(function(){return e=o.src,t=r.textContent,T(_),g.src=e,g.alt=t,void(x.textContent=t);var e,t})),t.owner.name!==q.textContent?n.querySelector(".element__delete").classList.add("element__delete_hidden"):n.querySelector(".element__delete").addEventListener("click",(function(n){T(h),function(t,n){S.addEventListener("click",(function(){var o;(o=n._id,fetch("".concat(e.apiURL,"/cards/").concat(o),{method:"DELETE",headers:e.headers}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){t.closest(".element").remove()})).catch((function(e){console.log(e)})),P(h)}))}(n.target,t)})),n.querySelector(".element__like").addEventListener("click",(function(n){var o;n.target.classList.contains("element__like_active")?((o=t._id,fetch("".concat(e.apiURL,"/cards/likes/").concat(o),{method:"DELETE",headers:e.headers}).then((function(e){return C(e)}))).then((function(e){c.textContent=e.likes.length})).catch((function(e){console.log(e)})),n.target.classList.remove("element__like_active")):(function(t){return fetch("".concat(e.apiURL,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return C(e)}))}(t._id).then((function(e){c.textContent=e.likes.length})).catch((function(e){console.log(e)})),n.target.classList.add("element__like_active"))})),n}function U(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))}function R(e){"Escape"===e.key&&P(document.querySelector(".popup_open"))}function w(e){var n=e.querySelector(t.formSelector);!function(e){var n=e.querySelector(t.submitButtonSelector);Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(e){e.classList.remove(t.inputErrorClass)})),Array.from(e.querySelectorAll(t.errorField)).forEach((function(e){e.textContent="",e.classList.remove(t.errorClass)})),n.classList.add(t.inactiveButtonClass),n.setAttribute("disabled",!0)}(e),n.reset()}function B(e,t){e.textContent=t?"Сохранение...":"Сохранить"}function T(e){e.classList.add("popup_open"),document.addEventListener("keydown",R)}function P(e){document.removeEventListener("keydown",R),e.classList.remove("popup_open")}E=t,Array.from(document.querySelectorAll(E.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);U(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector("#".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),U(n,o,t)}))}))}(e,E)})),fetch("".concat(e.apiURL,"/users/me"),{headers:e.headers}).then((function(e){return C(e)})).then((function(e){q.textContent=e.name,L.textContent=e.about,y.src=e.avatar})).catch((function(e){console.log(e)})),fetch("".concat(e.apiURL,"/cards"),{headers:e.headers}).then((function(e){return C(e)})).then((function(e){!function(e){e.forEach((function(e){b.append(A(e))}))}(e)})).catch((function(e){console.log(e)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup_open")&&P(e),t.target.classList.contains("popup__close")&&P(e)}))})),n.addEventListener("click",(function(){w(c),T(c),i.value=q.textContent,u.value=L.textContent})),o.addEventListener("click",(function(){w(l),T(l)})),r.addEventListener("click",(function(){w(f),T(f)})),a.addEventListener("submit",(function(){q.textContent=i.value,L.textContent=u.value;var t,n,o=a.querySelector(".popup__save");o.setAttribute("disabled",!0),B(o,!0),(t=i.value,n=u.value,fetch("".concat(e.apiURL,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return C(e)}))).catch((function(e){console.log(e)})).finally((function(){o.removeAttribute("disabled"),B(o,!1)})),P(c)})),s.addEventListener("submit",(function(){var t,n;(t=p.value,n=d.value,fetch("".concat(e.apiURL,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return C(e)}))).then((function(e){b.prepend(A(e))})).catch((function(e){console.log(e)})),P(l)})),m.addEventListener("submit",(function(){y.src=v.value;var t,n=m.querySelector(".popup__save");n.setAttribute("disabled",!0),B(n,!0),(t=v.value,fetch("".concat(e.apiURL,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return C(e)}))).catch((function(e){console.log(e)})).finally((function(){n.removeAttribute("disabled"),B(n,!1)})),P(f)}))})();